*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]


## Sub-chains ##
:main-input - [0:0]
:main-output - [0:0]
:fail2ban-input - [0:0]


## Sub-chain Jumps ##
-A INPUT -j fail2ban-input
-A INPUT -j main-input
-A OUTPUT -j main-output


## General Rules ##
# Allow all connections on loopback interface
-A main-input -i lo -j ACCEPT
-A main-output -o lo -j ACCEPT

# Allow traffic for any already established/related connections on wlp2s0
-A main-input -i wlp2s0 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A main-output -o wlp2s0 -m state --state RELATED,ESTABLISHED -j ACCEPT

# Drop all incoming invalid packets
-A main-input -m state --state INVALID -j DROP

# Allow all outbound traffic on local subnets
-A main-output -p all -o wlp2s0 -d 192.168.0.0/16 -j ACCEPT
-A main-output -p all -o wlp2s0 -d 10.0.0.0/8 -j ACCEPT
-A main-output -p all -o wlp2s0 -d 172.16.0.0/12 -j ACCEPT

# Allow all outbound traffic on reserved multicast IPs
-A main-output -p all -o wlp2s0 -d 224.0.0.0/24 -j ACCEPT

# Allow all outbound traffic on link-local IPs
-A main-output -p all -o wlp2s0 -d 169.254.0.0/16 -j ACCEPT


## Specific Inbound Rules ##
# Allow new inbound ssh connections on wlp2s0
-A main-input -i wlp2s0 -p tcp -m state --state NEW --dport 900 -j ACCEPT


COMMIT
